<!-- account.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ShopEase — My Account</title>
    <meta name="description" content="Manage your profile, orders, and addresses on ShopEase.">

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Shared CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>

<body>
    <!-- NAVBAR -->
    <header class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container py-2">
            <a class="navbar-brand fw-bold fs-3" href="index.html">ShopEase</a>
            <ul class="navbar-nav ms-auto align-items-center">
                <li class="nav-item"><a href="index.html" class="nav-link"><i class="bi bi-house me-1"></i>Home</a></li>
                <li class="nav-item"><a href="cart.html" class="nav-link"><i class="bi bi-cart me-1"></i>Cart</a></li>
            </ul>
        </div>
    </header>

    <!-- ACCOUNT DASHBOARD -->
    <main class="container my-5 account-page">
        <h2 class="fw-semibold mb-4">My Account</h2>

        <div class="row g-4">
            <!-- Sidebar Nav -->
            <aside class="col-lg-3">
                <div class="list-group shadow-sm rounded-4 overflow-hidden">
                    <button class="list-group-item list-group-item-action active" data-section="profile">
                        <i class="bi bi-person-circle me-2"></i>Profile
                    </button>
                    <button class="list-group-item list-group-item-action" data-section="orders">
                        <i class="bi bi-box-seam me-2"></i>Orders
                    </button>
                    <button class="list-group-item list-group-item-action" data-section="addresses">
                        <i class="bi bi-geo-alt me-2"></i>Addresses
                    </button>
                    <button class="list-group-item list-group-item-action" data-section="wishlist">
                        <i class="bi bi-heart me-2"></i>Wishlist
                    </button>
                </div>
            </aside>

            <!-- Main content -->
            <section class="col-lg-9">
                <!-- Profile -->
                <div id="profileSection" class="account-section card border-0 shadow-sm rounded-4 p-4">
                    <h5 class="fw-semibold mb-3"><i class="bi bi-person-circle text-primary me-2"></i>Profile
                        Information</h5>
                    <form id="profileForm" class="vstack gap-3" novalidate>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="accName" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="accEmail" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="accPhone">
                            </div>
                        </div>
                        <div class="mt-3">
                            <button type="submit" class="btn btn-primary rounded-pill px-4">Save Changes</button>
                            <button type="button" id="logoutBtn"
                                class="btn btn-outline-danger rounded-pill px-4 ms-2">Logout</button>
                        </div>
                    </form>
                </div>

                <!-- Orders -->
                <div id="ordersSection" class="account-section card border-0 shadow-sm rounded-4 p-4 d-none">
                    <h5 class="fw-semibold mb-3"><i class="bi bi-box-seam text-primary me-2"></i>My Orders</h5>
                    <div id="ordersList" class="vstack gap-3 small"></div>
                </div>

                <!-- Addresses -->
                <div id="addressesSection" class="account-section card border-0 shadow-sm rounded-4 p-4 d-none">
                    <h5 class="fw-semibold mb-3"><i class="bi bi-geo-alt text-primary me-2"></i>Saved Addresses</h5>
                    <div id="addressList" class="vstack gap-3 small mb-3"></div>
                    <form id="addressForm" class="row g-3 mt-2">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="addrName" placeholder="Full Name" required>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="addrPhone" placeholder="Phone" required>
                        </div>
                        <div class="col-md-12">
                            <input type="text" class="form-control" id="addrLine" placeholder="Address Line" required>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="addrCity" placeholder="City" required>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="addrPostal" placeholder="Postal Code" required>
                        </div>
                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-primary rounded-pill px-4">Add Address</button>
                        </div>
                    </form>
                </div>

                <!-- Wishlist -->
                <div id="wishlistSection" class="account-section card border-0 shadow-sm rounded-4 p-4 d-none">
                    <h5 class="fw-semibold mb-3"><i class="bi bi-heart text-primary me-2"></i>My Wishlist</h5>
                    <div id="wishlistItems" class="row g-3"></div>
                </div>
            </section>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container text-center small">
            <p class="mb-1">&copy; 2025 ShopEase — All rights reserved.</p>
            <p class="mb-0">Images: Unsplash — credited in data.js.</p>
        </div>
    </footer>

    <!-- Bootstrap & Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/data.js"></script>
    <script src="js/script.js"></script>

    <!-- Page-Specific Script -->
    <script>
        (function () {
            'use strict';
            const userKey = 'shop_user';
            const ordersKey = 'shop_orders';
            const wishlistKey = 'shop_wishlist';
            const products = window.products || [];

            const sections = document.querySelectorAll('.account-section');
            const navBtns = document.querySelectorAll('.list-group-item');

            // NAV HANDLER
            navBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    navBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const sec = btn.dataset.section;
                    sections.forEach(s => s.classList.toggle('d-none', s.id !== sec + 'Section'));
                });
            });

            // PROFILE
            const form = document.getElementById('profileForm');
            const logoutBtn = document.getElementById('logoutBtn');
            const user = JSON.parse(localStorage.getItem(userKey) || '{}');
            document.getElementById('accName').value = user.name || 'John Doe';
            document.getElementById('accEmail').value = user.email || 'john@example.com';
            document.getElementById('accPhone').value = user.phone || '';

            form.addEventListener('submit', e => {
                e.preventDefault();
                const updated = {
                    name: accName.value,
                    email: accEmail.value,
                    phone: accPhone.value,
                    addresses: user.addresses || []
                };
                localStorage.setItem(userKey, JSON.stringify(updated));
                showToast('Profile updated!');
            });

            logoutBtn.addEventListener('click', () => {
                localStorage.removeItem(userKey);
                localStorage.removeItem('shop_cart');
                showToast('Logged out!');
                setTimeout(() => location.href = 'index.html', 1000);
            });

            // ORDERS
            const ordersList = document.getElementById('ordersList');
            const orders = JSON.parse(localStorage.getItem(ordersKey) || '[]');
            if (!orders.length) {
                ordersList.innerHTML = '<p class="text-muted mb-0">No orders yet.</p>';
            } else {
                orders.forEach(o => {
                    const div = document.createElement('div');
                    div.className = 'border rounded-3 p-3';
                    div.innerHTML = `
            <div class="d-flex justify-content-between mb-1">
              <span class="fw-semibold">Order #${o.id}</span>
              <span class="badge bg-success">${o.status}</span>
            </div>
            <div class="small text-muted mb-2">${new Date(o.createdAt).toLocaleDateString()}</div>
            ${o.items.map(i => `<div>${i.title} × ${i.qty}</div>`).join('')}
            <div class="fw-semibold mt-2">Total: ₹${o.total.toLocaleString('en-IN')}</div>
          `;
                    ordersList.appendChild(div);
                });
            }

            // ADDRESSES
            const addrList = document.getElementById('addressList');
            const addrForm = document.getElementById('addressForm');
            const renderAddresses = () => {
                const u = JSON.parse(localStorage.getItem(userKey) || '{}');
                addrList.innerHTML = '';
                (u.addresses || []).forEach((a, idx) => {
                    const d = document.createElement('div');
                    d.className = 'border rounded-3 p-3 position-relative';
                    d.innerHTML = `<strong>${a.name}</strong><br>${a.line}, ${a.city} - ${a.postal}<br><span class="text-muted small">${a.phone}</span>
          <button class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2 remove" data-i="${idx}"><i class="bi bi-x"></i></button>`;
                    addrList.appendChild(d);
                });
                addrList.querySelectorAll('.remove').forEach(b => {
                    b.addEventListener('click', () => {
                        const u = JSON.parse(localStorage.getItem(userKey) || '{}');
                        u.addresses.splice(b.dataset.i, 1);
                        localStorage.setItem(userKey, JSON.stringify(u));
                        renderAddresses();
                        showToast('Address removed');
                    });
                });
            };
            renderAddresses();

            addrForm.addEventListener('submit', e => {
                e.preventDefault();
                const newAddr = {
                    name: addrName.value, phone: addrPhone.value, line: addrLine.value,
                    city: addrCity.value, postal: addrPostal.value
                };
                const u = JSON.parse(localStorage.getItem(userKey) || '{}');
                u.addresses = u.addresses || [];
                u.addresses.push(newAddr);
                localStorage.setItem(userKey, JSON.stringify(u));
                addrForm.reset();
                renderAddresses();
                showToast('Address added!');
            });

            // WISHLIST
            const wishContainer = document.getElementById('wishlistItems');
            const wishlist = JSON.parse(localStorage.getItem(wishlistKey) || '[]');
            if (!wishlist.length) {
                wishContainer.innerHTML = '<p class="text-muted mb-0">Your wishlist is empty.</p>';
            } else {
                wishlist.forEach(id => {
                    const p = products.find(pr => pr.id === id);
                    if (!p) return;
                    const col = document.createElement('div');
                    col.className = 'col-md-4 col-sm-6';
                    col.innerHTML = `
            <article class="pcard shadow-sm rounded-4 overflow-hidden position-relative">
              <img src="${p.images?.[0] || 'https://via.placeholder.com/400'}" alt="${p.title}" class="w-100" style="aspect-ratio:1/1;object-fit:cover;">
              <div class="p-3">
                <h6 class="fw-semibold mb-1">${p.title}</h6>
                <div class="text-primary fw-bold">₹${p.price}</div>
                <button class="btn btn-outline-danger btn-sm rounded-pill mt-2 removeWish" data-id="${p.id}">Remove</button>
              </div>
            </article>
          `;
                    wishContainer.appendChild(col);
                });
                wishContainer.querySelectorAll('.removeWish').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const w = JSON.parse(localStorage.getItem(wishlistKey) || '[]').filter(x => x != btn.dataset.id);
                        localStorage.setItem(wishlistKey, JSON.stringify(w));
                        btn.closest('.col-md-4').remove();
                        showToast('Removed from wishlist');
                    });
                });
            }

            // small toast helper
            function showToast(msg) {
                const t = document.createElement('div');
                t.className = 'position-fixed bottom-0 end-0 m-3 bg-dark text-white px-3 py-2 rounded shadow';
                t.textContent = msg;
                document.body.appendChild(t);
                setTimeout(() => t.remove(), 1600);
            }
        })();
    </script>
</body>

</html>